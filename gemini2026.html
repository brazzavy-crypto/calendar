<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è¯­è¨€ç²¾è¿›æ—¥å†</title>
    <style>
        :root { --gold: #b8860b; --bg: #fdfaf2; --accent: #603; --done: #28a745; }
        body { font-family: 'STSong', 'PingFang SC', serif; background: #eee; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .calendar-nav { display: grid; grid-template-columns: repeat(11, 1fr); gap: 4px; margin-bottom: 15px; background: #fff; padding: 8px; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .cal-dot { width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; border: 1px solid #eee; border-radius: 4px; color: #999; position: relative; }
        .cal-dot.active { border: 1px solid var(--gold); background: #fff9eb; color: var(--gold); font-weight: bold; }
        .cal-dot.completed::after { content: ''; width: 4px; height: 4px; background: var(--done); border-radius: 50%; position: absolute; bottom: 1px; }
        
        .container { background: var(--bg); max-width: 600px; width: 100%; padding: 25px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); box-sizing: border-box; }
        .date-header { text-align: center; border-bottom: 1px solid #ddd; margin-bottom: 20px; padding-bottom: 10px; }
        .date-main { font-size: 1.3em; font-weight: bold; margin: 0; color: #333; }
        .date-sub { font-size: 0.8em; color: #666; margin: 4px 0; line-height: 1.5; }
        
        .section-title { border-left: 3px solid var(--gold); padding-left: 8px; margin: 20px 0 10px; font-weight: bold; font-size: 0.95em; color: #444; }
        .quote-item { margin-bottom: 12px; }
        .quote-text { font-size: 0.95em; line-height: 1.4; color: #111; font-weight: 500; }
        .quote-cn { font-size: 0.85em; color: #666; margin-top: 2px; font-style: italic; }
        
        .exercise-container { background: rgba(0,0,0,0.02); padding: 12px; border-radius: 4px; margin-bottom: 10px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .opt-btn { padding: 10px; border: 1px solid #ccc; background: white; cursor: pointer; border-radius: 4px; font-size: 0.85em; text-align: left; }
        .opt-btn.correct { background: #d4edda !important; border-color: #28a745 !important; }
        .opt-btn.wrong { background: #f8d7da !important; border-color: #dc3545 !important; }
        
        textarea { width: 100%; height: 75px; margin-top: 8px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; box-sizing: border-box; font-size: 13px; background: rgba(255,255,255,0.5); font-family: inherit; }
.ans-show {
    margin-top: 10px;
    font-size: 0.95em;
    line-height: 1.8;
    color: #444;
    padding: 15px;
    background: #fdfaf2;
    border-radius: 6px;
    border: 1px solid #eee;
    white-space: pre-wrap; /* ä¿æŒèŒƒæ–‡çš„æ¢è¡Œæ ¼å¼ */
    word-wrap: break-word;
}
        .secret-trigger { height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #ddd; font-size: 14px; margin-top: 10px; }
        .hidden-content { display: none; }
        ruby rt { font-size: 0.6em; color: var(--gold); }

/* åº•éƒ¨æŒ‰é’®åŒº - ç®€æ´æ¨ªæ’ç‰ˆ */
.admin-btns { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    gap: 8px; 
    margin-top: 40px; 
    padding-top: 20px; 
    border-top: 1px dashed #ddd; 
}
.report-btn { 
    background: var(--accent); 
    color: white; 
    border: none; 
    padding: 8px 14px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: bold; 
    font-size: 12px; 
}
.secondary-btn { 
    background: #f8f8f8; 
    color: #666; 
    border: 1px solid #ddd; 
    padding: 8px 12px; 
    border-radius: 6px; 
    font-size: 12px; 
    cursor: pointer; 
}

/* é‰´èµæŒ‰é’®ï¼šå¤å…¸æ·±çº¢è‰²é£æ ¼ */
.btn-reading {
    border-color: #722f37 !important; /* å‹ƒè‰®ç¬¬é…’çº¢ */
    color: #722f37 !important;
    background: #fffafa !important;
    font-weight: bold;
    letter-spacing: 1px;
}

/* é‰´èµæ¡†å†…éƒ¨æ’ç‰ˆï¼šä¸­è‹±æ–‡åŒºåˆ† */
.reading-text-en { color: #333; font-family: 'Georgia', serif; margin-bottom: 20px; }
.reading-text-cn { color: #666; border-top: 1px dashed #ccc; padding-top: 15px; }
    </style>
</head>
<body>

<div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 15px; width: 100%;">
    <button onclick="changeMonth(-1)" style="border:none; background:var(--gold); color:white; cursor:pointer; width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">â®</button>
    <span id="month-display" style="font-weight: bold; color: var(--gold); font-size: 1.1em; min-width: 100px; text-align: center; letter-spacing: 1px;">2026-02</span>
    <button onclick="changeMonth(1)" style="border:none; background:var(--gold); color:white; cursor:pointer; width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">â¯</button>
</div>

<div id="calendar-view" class="calendar-nav"></div>

<div class="container">
    <div class="date-header">
        <h1 class="date-main" id="date-cn">åŠ è½½ä¸­...</h1>
        <p class="date-sub" id="date-lang-sub"></p>
        <p id="lunar-info" style="color:var(--gold); font-size:0.85em; font-weight:bold; margin-top:5px;"></p>
    </div>

    <div class="quote-box">
        <div class="quote-item">
            <div class="quote-text"><strong>EN:</strong> <span id="en_q"></span></div>
            <div class="quote-cn" id="en_cn"></div>
        </div>
        <div class="quote-item">
            <div class="quote-text"><strong>JP:</strong> <span id="jp_q"></span></div>
            <div class="quote-cn" id="jp_cn"></div>
        </div>
        <div class="quote-item">
            <div class="quote-text"><strong>FR:</strong> <span id="fr_q"></span></div>
            <div class="quote-cn" id="fr_cn"></div>
        </div>
    </div>

    <div id="exercises-area">
        <div class="section-title">è¯­è¨€è¿›é˜¶ç»ƒä¹ </div>
        <div class="exercise-container">
            <p><strong>æ—¥æœ¬èª:</strong> <span id="jp_ex_q"></span></p>
            <div id="jp_input_area"></div>
        </div>
        <div class="exercise-container">
            <p><strong>FranÃ§ais:</strong> <span id="fr_ex_q"></span></p>
            <div id="fr_input_area"></div>
        </div>
    </div>

    <div class="section-title">åˆ›ä½œè¡¨è¾¾</div>
    <div class="exercise-container">
        <p id="write_c_q" style="font-size:0.9em; margin-bottom:5px;"></p>
        <textarea id="write_c_input" oninput="saveCurrentData()" placeholder="å¼€å§‹å†™ä½œ..."></textarea>
    </div>

    <div class="secret-trigger" onclick="toggleAdult()">â™¢</div>
    <div class="hidden-content" id="adult-content">
        <div class="exercise-container" style="border-top: 1px solid var(--accent);">
            <p id="write_a_q" style="font-size:0.9em; margin-bottom:5px; font-weight:bold; color:var(--accent);"></p>
            <textarea id="write_a_input" oninput="saveCurrentData()" placeholder="ç§å¯†å†™ä½œ..."></textarea>
        </div>
    </div>

<div class="admin-btns">
    <button class="report-btn" onclick="generateWeeklyReport()">ğŸ“Š æœ¬å‘¨è¯„å®¡</button>
    <button class="secondary-btn" onclick="exportData()">ğŸ’¾ å¤‡ä»½</button>
    <button class="secondary-btn" onclick="document.getElementById('importFile').click()">ğŸ“‚ è¿˜åŸ</button>
    <input type="file" id="importFile" style="display:none" onchange="importData(event)">
</div>
</div>

<textarea id="copy-temp" style="position:absolute; left:-9999px;"></textarea>

<script src="data.js"></script>

<script>
// --- åˆå§‹åŒ–å˜é‡ ---
let displayedMonth = 2; // é»˜è®¤è¿›å…¥2æœˆ
let currentShowingDate = "2026-02-01"; // é»˜è®¤é€‰ä¸­2æœˆ1æ—¥
let userStorage = JSON.parse(localStorage.getItem('cal_progress_2026')) || {};

function init() {
    renderCalendarNav();
    loadDate(currentShowingDate);
}

// æœˆä»½åˆ‡æ¢å‡½æ•°
function changeMonth(delta) {
    let newMonth = displayedMonth + delta;
    if (newMonth >= 1 && newMonth <= 12) {
        displayedMonth = newMonth;
        renderCalendarNav();
    }
}

// æ ¸å¿ƒæ¸²æŸ“å‡½æ•°ï¼šæ ¹æ® displayedMonth åŠ¨æ€ç”Ÿæˆæ—¥å†åœ†ç‚¹
function renderCalendarNav() {
    const nav = document.getElementById('calendar-view');
    const monthLabel = document.getElementById('month-display');
    nav.innerHTML = '';
    
    const mStr = String(displayedMonth).padStart(2, '0');
    if(monthLabel) monthLabel.innerText = `2026-${mStr}`;

    // åŠ¨æ€è·å–è¯¥æœˆå¤©æ•°ï¼ˆ2026å¹´éé—°å¹´ï¼Œ2æœˆä¼šè‡ªåŠ¨è¿”å›28ï¼‰
    const daysInMonth = new Date(2026, displayedMonth, 0).getDate();

    for(let i=1; i<=daysInMonth; i++) {
        const dStr = `2026-${mStr}-${String(i).padStart(2,'0')}`;
        const dot = document.createElement('div');
        
        // æ ·å¼çŠ¶æ€ï¼šé€‰ä¸­ã€æœ‰æ•°æ®ã€å·²å®Œæˆ
        dot.className = `cal-dot ${dStr === currentShowingDate ? 'active' : ''}`;
        if (calendarData.some(x => x.date === dStr)) dot.classList.add('has-data');
        if (userStorage[dStr]?.done) dot.classList.add('completed');
        
        dot.innerText = i;
        dot.onclick = () => {
            currentShowingDate = dStr;
            loadDate(dStr);
            renderCalendarNav(); // åˆ·æ–°æ¿€æ´»çŠ¶æ€
        };
        nav.appendChild(dot);
    }
}

function loadDate(dStr) {
    const data = calendarData.find(x => x.date === dStr);
    if(!data) {
        // å¦‚æœè¯¥å¤©æ²¡æ•°æ®ï¼Œæ˜¾ç¤ºç©ºç™½æé†’
        document.getElementById('date-cn').innerText = dStr + " (æš‚æ— æ•°æ®)";
        return;
    }
    const saved = userStorage[dStr] || {};

    // åŸºç¡€ä¿¡æ¯æ¸²æŸ“
    document.getElementById('date-cn').innerText = `${data.date.split('-')[1]}æœˆ${data.date.split('-')[2]}æ—¥ ${data.week_cn || ''}`;
    document.getElementById('date-lang-sub').innerHTML = `${data.date_fr}<br>${data.date_jp}`;
    document.getElementById('lunar-info').innerText = data.lunar;

    // åè¨€æ¸²æŸ“
    document.getElementById('en_q').innerText = data.en_q;
    document.getElementById('en_cn').innerText = data.en_cn || "";
    document.getElementById('jp_q').innerHTML = data.jp_q;
    document.getElementById('jp_cn').innerText = data.jp_cn || "";
    document.getElementById('fr_q').innerText = data.fr_q;
    document.getElementById('fr_cn').innerText = data.fr_cn || "";

    // ä¹ é¢˜æ¸²æŸ“
    renderFlexibleEx('jp', data.jp_ex, data.jp_ans, saved);
    renderFlexibleEx('fr', data.fr_ex, data.fr_ans, saved);

    // å†™ä½œåŒºæ¸²æŸ“
    document.getElementById('write_c_q').innerText = data.write_c;
    document.getElementById('write_c_input').value = saved.write_c || '';
    document.getElementById('write_a_q').innerText = data.write_a;
    document.getElementById('write_a_input').value = saved.write_a || '';
    
    // éšè—åŒºæ‰©å±•æ¨¡å— (èŒƒæ–‡ & é‰´èµ)
    const adultArea = document.getElementById('adult-content');
    const oldExtra = adultArea.querySelector('.extra-wrap');
    if(oldExtra) oldExtra.remove();

    const extraWrap = document.createElement('div');
    extraWrap.className = 'extra-wrap';
    extraWrap.style.marginTop = "10px";

    if(data.write_a_sample) {
        const sampleBtn = document.createElement('button');
        sampleBtn.className = 'secondary-btn';
        sampleBtn.style = "padding: 4px 10px; font-size: 11px; border-color:var(--accent); color:var(--accent); margin-right:8px;";
        sampleBtn.innerText = "èŒƒæ–‡";
        const sampleContent = document.createElement('div');
        sampleContent.className = 'ans-show';
        sampleContent.style.display = 'none';
        sampleContent.innerHTML = `<div style="color:var(--accent); font-weight:bold; margin-bottom:5px;">å‚è€ƒèŒƒæ–‡ï¼š</div>${data.write_a_sample}`;
        sampleBtn.onclick = () => sampleContent.style.display = sampleContent.style.display === 'none' ? 'block' : 'none';
        extraWrap.appendChild(sampleBtn);
        extraWrap.appendChild(sampleContent);
    }

    if(data.daily_reading) {
        const readBtn = document.createElement('button');
        readBtn.className = 'secondary-btn';
        readBtn.style = "padding: 4px 10px; font-size: 11px; border-color:#966; color:#966;";
        readBtn.innerText = "é‰´èµ";
        const readContent = document.createElement('div');
        readContent.className = 'ans-show';
        readContent.style.display = 'none';
        readContent.style.borderLeft = "3px solid #966";
        let htmlBuffer = `<div style="color:#966; font-weight:bold; margin-bottom:5px;">æ–‡å­¦ç‰‡æ®µé‰´èµï¼š</div>${data.daily_reading}`;
        if (data.mimic_task) {
            htmlBuffer += `<div style="margin-top:15px; padding:10px; border-top:1px dashed #966; background:rgba(150,102,102,0.05);"><div style="color:#966; font-weight:bold; font-size:12px; margin-bottom:4px;">âœï¸ æ¨¡ä»¿æŒ‘æˆ˜ï¼š</div><div style="color:#444; font-size:13px;">${data.mimic_task}</div></div>`;
        }
        readContent.innerHTML = htmlBuffer;
        readBtn.onclick = () => readContent.style.display = readContent.style.display === 'none' ? 'block' : 'none';
        extraWrap.appendChild(readBtn);
        extraWrap.appendChild(readContent);
    }
    adultArea.appendChild(extraWrap);
}

// å…¶ä½™è¾…åŠ©å‡½æ•°ä¿æŒä¸å˜
function renderFlexibleEx(lang, rawEx, correctAns, saved) {
    const qEl = document.getElementById(lang + '_ex_q');
    const area = document.getElementById(lang + '_input_area');
    area.innerHTML = '';
    const data = calendarData.find(x => x.date === currentShowingDate);
    const tips = (lang === 'jp' ? data.jp_ans_tips : data.fr_ans_tips) || "";

    if (rawEx.includes('A.')) {
        const opts = rawEx.match(/[A-D]\.[^A-D]+/g) || [];
        const grid = document.createElement('div');
        grid.className = 'options-grid';
        const tipEl = document.createElement('div');
        tipEl.className = 'ans-show';
        tipEl.style.display = 'none';

        opts.forEach(optStr => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = optStr.trim();
            const char = optStr.trim().charAt(0);
            if(saved[lang + '_choice'] === char) {
                btn.classList.add(char === correctAns ? 'correct' : 'wrong');
            }
            btn.onclick = () => {
                saveCurrentData(lang + '_choice', char);
                renderFlexibleEx(lang, rawEx, correctAns, userStorage[currentShowingDate]);
            };
            grid.appendChild(btn);
        });
        area.appendChild(grid);
        if(saved[lang + '_choice']) {
            tipEl.innerHTML = `<strong>è§£æï¼š</strong>${tips}`;
            tipEl.style.display = 'block';
            area.appendChild(tipEl);
        }
    } else {
        const txt = document.createElement('textarea');
        txt.value = saved[lang + '_text'] || '';
        txt.oninput = (e) => saveCurrentData(lang + '_text', e.target.value);
        const ansBtn = document.createElement('button');
        ansBtn.innerText = "æŸ¥çœ‹ç­”æ¡ˆ";
        const ansDiv = document.createElement('div');
        ansDiv.className = 'ans-show';
        ansDiv.style.display = 'none';
        ansDiv.innerHTML = `<strong>ç­”æ¡ˆï¼š</strong>${correctAns}<br><strong>è§£æï¼š</strong>${tips}`;
        ansBtn.onclick = () => ansDiv.style.display = 'block';
        area.appendChild(txt); area.appendChild(ansBtn); area.appendChild(ansDiv);
    }
}

function saveCurrentData(key, val) {
    if(!userStorage[currentShowingDate]) userStorage[currentShowingDate] = {};
    if(key) userStorage[currentShowingDate][key] = val;
    userStorage[currentShowingDate].write_c = document.getElementById('write_c_input').value;
    userStorage[currentShowingDate].write_a = document.getElementById('write_a_input').value;
    userStorage[currentShowingDate].done = true;
    localStorage.setItem('cal_progress_2026', JSON.stringify(userStorage));
    renderCalendarNav();
}

function toggleAdult() {
    const c = document.getElementById('adult-content');
    c.style.display = (c.style.display === 'block') ? 'none' : 'block';
}

window.onload = init;
</script>
</body>
</html>