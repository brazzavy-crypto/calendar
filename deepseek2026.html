<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026每日学习日历</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --japanese: #bc002d;
            --french: #0055a4;
            --english: #3d5a80;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px 20px 0 0;
            padding: 25px 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
        }
        
        .date-display {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .today-date {
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 8px;
        }
        
        .date-subtitle {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 3px;
            line-height: 1.4;
        }
        
        .date-japanese, .date-french {
            font-size: 0.85rem;
            margin: 2px 0;
            display: block;
        }
        
        .date-japanese {
            color: var(--japanese);
        }
        
        .date-french {
            color: var(--french);
        }
        
        .today-lunar {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-top: 8px;
        }
        
        .calendar-toggle-top {
            text-align: center;
            margin: 15px 0;
        }
        
        .toggle-calendar-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background 0.3s;
        }
        
        .toggle-calendar-btn:hover {
            background: #2980b9;
        }
        
        .calendar-view {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-month {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .calendar-nav button {
            background: var(--primary);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            margin: 0 5px;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-nav button:hover {
            background: #2980b9;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary);
            padding: 0 5px;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
            font-size: 0.9rem;
            border: 1px solid #e0e0e0;
        }
        
        .calendar-day:hover {
            background: #f0f7ff;
            transform: scale(1.05);
        }
        
        .calendar-day.current-month {
            background: white;
        }
        
        .calendar-day.other-month {
            background: #f8f9fa;
            color: #aaa;
            border-color: #eee;
        }
        
        .calendar-day.today {
            border: 2px solid var(--accent);
            font-weight: bold;
        }
        
        .calendar-day.completed {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-color: var(--success);
            font-weight: bold;
        }
        
        .calendar-day.partial {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-color: var(--warning);
        }
        
        .calendar-day.has-writing {
            background: #e8f5e9;
            border-color: var(--success);
        }
        
        .calendar-day.has-exercises {
            background: #e3f2fd;
            border-color: var(--primary);
        }
        
        .day-indicators {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 0.7rem;
            display: flex;
            gap: 1px;
        }
        
        .indicator-writing {
            color: var(--success);
        }
        
        .indicator-japanese {
            color: var(--japanese);
        }
        
        .indicator-french {
            color: var(--french);
        }
        
        .calendar-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            font-size: 0.8rem;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .refresh-time {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 15px 0;
            text-align: center;
            color: white;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
            color: white;
        }
        
        .english .card-icon { background: var(--english); }
        .japanese .card-icon { background: var(--japanese); }
        .french .card-icon { background: var(--french); }
        .writing .card-icon { background: var(--success); }
        
        .card-title {
            font-size: 1.5rem;
            color: var(--secondary);
        }
        
        .quote-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 15px;
            font-style: italic;
            color: #2c3e50;
        }
        
        .quote-translation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }
        
        .quote-source {
            text-align: right;
            color: #7f8c8d;
            font-size: 0.95rem;
        }
        
        .exercise-section {
            margin-top: 20px;
        }
        
        .exercise-title {
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .difficulty-badge {
            background: var(--warning);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .exercise-question {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .options {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .option {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            border-color: var(--primary);
            background: #f0f7ff;
        }
        
        .option.selected {
            border-color: var(--primary);
            background: #e3f2fd;
        }
        
        .option-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: #f0f0f0;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .answer-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .answer-btn:hover {
            background: #2980b9;
        }
        
        .answer-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .explanation {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .exercise-feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .correct-feedback {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid var(--success);
        }
        
        .wrong-feedback {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid var(--accent);
        }
        
        .writing-prompt {
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .requirements {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.95rem;
            color: #555;
        }
        
        .text-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            resize: vertical;
            margin-top: 10px;
        }
        
        .save-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 15px;
            transition: background 0.3s;
        }
        
        .save-btn:hover {
            background: #27ae60;
        }
        
        .calendar-nav {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 10px;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .nav-btn:hover {
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-btn:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            color: #999;
        }
        
        .progress-bar {
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            width: 0.27%;
            transition: width 0.5s ease;
        }
        
        .day-counter {
            text-align: center;
            margin-top: 10px;
            color: white;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            font-size: 0.9rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .correct-answer {
            border-color: var(--success) !important;
            background-color: #e8f5e9 !important;
        }
        
        .wrong-answer {
            border-color: var(--accent) !important;
            background-color: #ffebee !important;
        }
        
        .completed {
            color: var(--success);
        }
        
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
            }
            
            .today-date {
                font-size: 1.8rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .card {
                padding: 20px;
            }
            
            .calendar-day {
                height: 35px;
                font-size: 0.8rem;
            }
            
            .calendar-nav {
                flex-wrap: wrap;
            }
            
            .nav-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">进度已保存！</div>
    
    <div class="container">
        <header>
            <div class="date-display">
                <div class="today-date" id="today-date">2026年1月1日 星期四</div>
                <div class="date-subtitle" id="date-japanese-full">
                    2026年1月1日（木曜日）
                </div>
                <div class="date-japanese" id="date-japanese">にせんにじゅうろくねん いちがつ ついたち（もくようび）</div>
                <div class="date-subtitle" id="date-french-full">
                    1 janvier 2026 (jeudi)
                </div>
                <div class="date-french" id="date-french">premier janvier deux mille vingt-six</div>
                <div class="today-lunar" id="today-lunar">农历冬月十三</div>
            </div>
            
            <div class="calendar-toggle-top">
                <button class="toggle-calendar-btn" id="toggle-calendar">
                    <i class="fas fa-calendar-alt"></i> 查看学习日历
                </button>
            </div>
            
            <div class="progress-bar">
                <div class="progress" id="year-progress"></div>
            </div>
            <div class="day-counter" id="day-counter">第 1 天 / 共 365 天</div>
        </header>
        
        <!-- 月份日历视图 -->
        <div class="calendar-view" id="calendar-view">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button id="prev-calendar-month"><i class="fas fa-chevron-left"></i></button>
                </div>
                <div class="calendar-month" id="calendar-month">2026年1月</div>
                <div class="calendar-nav">
                    <button id="next-calendar-month"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="calendar-weekdays">
                <div>日</div><div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div>
            </div>
            
            <div class="calendar-days" id="calendar-days">
                <!-- 日期将通过JavaScript动态生成 -->
            </div>
            
            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8f5e9; border: 1px solid #4CAF50;"></div>
                    <span>已完成</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff3e0; border: 1px solid #FF9800;"></div>
                    <span>部分完成</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e3f2fd; border: 1px solid #2196F3;"></div>
                    <span>有练习</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8f5e9; border: 1px solid #4CAF50;"></div>
                    <span>有写作</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border: 2px solid #e74c3c;"></div>
                    <span>今天</span>
                </div>
            </div>
        </div>
        
        <div class="refresh-time" id="refresh-time">
            每日学习工具 • 上次更新: <span id="last-updated">刚刚</span> • 
            <a href="javascript:location.reload()" style="color:white;text-decoration:underline">刷新页面</a>
        </div>
        
        <div class="main-content">
            <!-- 英语名言卡片 -->
            <div class="card english">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-globe-americas"></i>
                    </div>
                    <h2 class="card-title">英语名言</h2>
                </div>
                
                <div class="quote-text" id="english-quote">
                    The only way to do great work is to love what you do.
                </div>
                
                <div class="quote-translation" id="english-translation">
                    做出伟大工作的唯一方法是热爱你所做的事情。
                </div>
                
                <div class="quote-source" id="english-source">
                    — Steve Jobs
                </div>
            </div>
            
            <!-- 日语学习卡片 -->
            <div class="card japanese">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-torii-gate"></i>
                    </div>
                    <h2 class="card-title">日语学习</h2>
                </div>
                
                <div class="quote-text" id="japanese-quote">
                    七転び八起き
                </div>
                
                <div class="quote-translation" id="japanese-translation">
                    七次跌倒，八次爬起（喻百折不挠）
                </div>
                
                <div class="quote-source" id="japanese-source">
                    — 日本谚语
                </div>
                
                <div class="exercise-section">
                    <div class="exercise-title">
                        <span>日语练习</span>
                        <span class="difficulty-badge" id="japanese-difficulty">N3</span>
                    </div>
                    
                    <div class="exercise-question" id="japanese-question">
                        次の文の（　）に入れるのに最もよいものを、1・2・3・4から一つ選びなさい。<br>
                        彼は約束を（　）から、信用できない。
                    </div>
                    
                    <div class="options" id="japanese-options">
                        <!-- 选项将通过JavaScript动态生成 -->
                    </div>
                    
                    <div class="exercise-feedback" id="japanese-feedback"></div>
                    
                    <button class="answer-btn" id="check-japanese">检查答案</button>
                    <button class="answer-btn" id="show-japanese-explanation">查看解析</button>
                    <button class="answer-btn" id="reset-japanese" style="background: #95a5a6;">重置</button>
                    
                    <div class="explanation" id="japanese-explanation">
                        <strong>正确答案：3</strong><br>
                        <strong>解析：</strong>「〜かねる」表示难以做某事，这里表示难以遵守约定。<br>
                        「守りがたい」表示几乎不可能遵守；「守りづらい」表示不容易遵守；「守りようがない」表示没有办法遵守。
                    </div>
                </div>
            </div>
            
            <!-- 法语学习卡片 -->
            <div class="card french">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-tower-eiffel"></i>
                    </div>
                    <h2 class="card-title">法语学习</h2>
                </div>
                
                <div class="quote-text" id="french-quote">
                    Chaque homme doit inventer son chemin.
                </div>
                
                <div class="quote-translation" id="french-translation">
                    每个人都必须开创自己的道路。
                </div>
                
                <div class="quote-source" id="french-source">
                    — Jean-Paul Sartre
                </div>
                
                <div class="exercise-section">
                    <div class="exercise-title">
                        <span>法语练习</span>
                        <span class="difficulty-badge" id="french-difficulty">B1</span>
                    </div>
                    
                    <div class="exercise-question" id="french-question">
                        Complétez la phrase: Si j'______ riche, j'achèterais une maison en Provence.
                    </div>
                    
                    <div class="options" id="french-options">
                        <!-- 选项将通过JavaScript动态生成 -->
                    </div>
                    
                    <div class="exercise-feedback" id="french-feedback"></div>
                    
                    <button class="answer-btn" id="check-french">检查答案</button>
                    <button class="answer-btn" id="show-french-explanation">查看解析</button>
                    <button class="answer-btn" id="reset-french" style="background: #95a5a6;">重置</button>
                    
                    <div class="explanation" id="french-explanation">
                        <strong>正确答案：1</strong><br>
                        <strong>解析：</strong>在si引导的假设从句中，表示与现在事实相反的假设要用未完成过去时（imparfait）。<br>
                        主句用条件式现在时（conditionnel présent）。整句意思：如果我有钱，我就在普罗旺斯买一栋房子。
                    </div>
                </div>
            </div>
            
            <!-- 创意写作卡片 -->
            <div class="card writing">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-pen-fancy"></i>
                    </div>
                    <h2 class="card-title">创意写作</h2>
                </div>
                
                <div class="writing-prompt" id="writing-prompt">
                    描述一个完全由气味构成的记忆。
                </div>
                
                <div class="requirements" id="writing-requirements">
                    <strong>要求：</strong>不少于200字，使用至少三种感官类比
                </div>
                
                <textarea class="text-area" id="writing-text" placeholder="在这里写下你的创意写作..."></textarea>
                
                <button class="save-btn" id="save-writing">
                    <i class="fas fa-save"></i> 保存写作
                </button>
                <span id="writing-status" style="margin-left: 15px; color: #666;"></span>
            </div>
        </div>
        
        <div class="calendar-nav">
            <button class="nav-btn" id="prev-day">
                <i class="fas fa-chevron-left"></i> 前一天
            </button>
            <button class="nav-btn" id="today-btn" disabled>
                <i class="fas fa-calendar-day"></i> 返回今天
            </button>
            <button class="nav-btn" id="next-day">
                后一天 <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <footer>
            <p>2026每日学习日历 • 专注语言学习与创意写作</p>
            <p>每日更新名言、练习与写作提示 • 数据保存在本地浏览器</p>
        </footer>
    </div>

    <script>
        // ==================== 配置 ====================
        const CONFIG = {
            year: 2026,
            languages: ['英语', '日语', '法语']
        };

        // ==================== 日语日期工具 ====================
        class JapaneseDateFormatter {
            static getJapaneseDate(date) {
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const weekday = date.getDay();
                
                const yearJapanese = this.getYearInJapanese(year);
                const monthJapanese = this.getMonthInJapanese(month);
                const dayJapanese = this.getDayInJapanese(day);
                const weekdayJapanese = this.getWeekdayInJapanese(weekday);
                
                return {
                    numeric: `${year}年${month}月${day}日（${this.getWeekdayChinese(weekday)}）`,
                    kana: `${yearJapanese} ${monthJapanese} ${dayJapanese}（${weekdayJapanese}）`
                };
            }
            
            static getYearInJapanese(year) {
                const digits = year.toString().split('');
                let result = '';
                
                for (let i = 0; i < digits.length; i++) {
                    const digit = parseInt(digits[i]);
                    const position = digits.length - i;
                    
                    const digitNames = ['ぜろ', 'いち', 'に', 'さん', 'よん', 'ご', 'ろく', 'なな', 'はち', 'きゅう'];
                    result += digitNames[digit];
                    
                    if (position === 4 && digit !== 0) result += 'せん';
                    else if (position === 3 && digit !== 0) result += 'ひゃく';
                    else if (position === 2 && digit !== 0) result += 'じゅう';
                }
                
                result += 'ねん';
                return result;
            }
            
            static getMonthInJapanese(month) {
                const monthNames = [
                    'いちがつ', 'にがつ', 'さんがつ', 'しがつ', 'ごがつ', 'ろくがつ',
                    'しちがつ', 'はちがつ', 'くがつ', 'じゅうがつ', 'じゅういちがつ', 'じゅうにがつ'
                ];
                return monthNames[month - 1];
            }
            
            static getDayInJapanese(day) {
                if (day === 1) return 'ついたち';
                if (day === 2) return 'ふつか';
                if (day === 3) return 'みっか';
                if (day === 4) return 'よっか';
                if (day === 5) return 'いつか';
                if (day === 6) return 'むいか';
                if (day === 7) return 'なのか';
                if (day === 8) return 'ようか';
                if (day === 9) return 'ここのか';
                if (day === 10) return 'とおか';
                if (day === 14) return 'じゅうよっか';
                if (day === 20) return 'はつか';
                if (day === 24) return 'にじゅうよっか';
                
                if (day <= 10) return this.getNumberInJapanese(day) + 'にち';
                if (day <= 19) return 'じゅう' + this.getDayInJapanese(day - 10);
                if (day <= 29) return 'にじゅう' + this.getDayInJapanese(day - 20);
                return 'さんじゅう' + this.getDayInJapanese(day - 30);
            }
            
            static getWeekdayInJapanese(weekday) {
                const weekdays = [
                    'にちようび', 'げつようび', 'かようび', 'すいようび', 
                    'もくようび', 'きんようび', 'どようび'
                ];
                return weekdays[weekday];
            }
            
            static getWeekdayChinese(weekday) {
                const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
                return `星期${weekdays[weekday]}`;
            }
            
            static getNumberInJapanese(num) {
                const numbers = ['れい', 'いち', 'に', 'さん', 'よん', 'ご', 'ろく', 'なな', 'はち', 'きゅう', 'じゅう'];
                return numbers[num] || num.toString();
            }
        }

        // ==================== 法语日期工具 ====================
        class FrenchDateFormatter {
            static getFrenchDate(date) {
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const weekday = date.getDay();
                
                const monthNames = [
                    'janvier', 'février', 'mars', 'avril', 'mai', 'juin',
                    'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'
                ];
                
                const weekdayNames = [
                    'dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'
                ];
                
                const dayOrdinal = day === 1 ? 'premier' : day.toString();
                
                return {
                    numeric: `${day} ${monthNames[month - 1]} ${year} (${weekdayNames[weekday]})`,
                    spelled: `${dayOrdinal} ${monthNames[month - 1]} ${this.getYearInFrench(year)}`
                };
            }
            
            static getYearInFrench(year) {
                if (year === 2000) return 'deux mille';
                if (year < 2000) {
                    const hundreds = Math.floor(year / 100);
                    const remainder = year % 100;
                    
                    let result = '';
                    if (hundreds > 0) {
                        result += this.getHundredsInFrench(hundreds);
                        if (remainder > 0) result += ' ';
                    }
                    
                    if (remainder > 0) {
                        result += this.getTensInFrench(remainder);
                    }
                    
                    return result;
                } else {
                    const thousands = Math.floor(year / 1000);
                    const remainder = year % 1000;
                    
                    let result = this.getThousandsInFrench(thousands);
                    
                    if (remainder > 0) {
                        if (remainder < 100) {
                            result += ' ' + this.getTensInFrench(remainder);
                        } else {
                            result += ' ' + this.getHundredsInFrench(Math.floor(remainder / 100));
                            const tens = remainder % 100;
                            if (tens > 0) {
                                result += ' ' + this.getTensInFrench(tens);
                            }
                        }
                    }
                    
                    return result;
                }
            }
            
            static getThousandsInFrench(num) {
                if (num === 1) return 'mille';
                return this.getNumberInFrench(num) + ' mille';
            }
            
            static getHundredsInFrench(num) {
                if (num === 1) return 'cent';
                return this.getNumberInFrench(num) + ' cents';
            }
            
            static getTensInFrench(num) {
                if (num < 17) {
                    const numbers = [
                        'zéro', 'un', 'deux', 'trois', 'quatre', 'cinq', 'six', 'sept', 'huit', 'neuf',
                        'dix', 'onze', 'douze', 'treize', 'quatorze', 'quinze', 'seize'
                    ];
                    return numbers[num];
                }
                
                if (num < 20) return 'dix-' + this.getTensInFrench(num - 10);
                
                const tens = Math.floor(num / 10);
                const units = num % 10;
                
                const tensNames = ['', '', 'vingt', 'trente', 'quarante', 'cinquante', 'soixante', 'soixante', 'quatre-vingt', 'quatre-vingt'];
                
                let result = tensNames[tens];
                
                if (units === 0) {
                    if (tens === 8) result += 's';
                } else if (units === 1 && tens !== 8 && tens !== 9) {
                    result += ' et un';
                } else if (tens === 7 || tens === 9) {
                    result = tensNames[tens];
                    const adjustedUnits = units + 10;
                    if (adjustedUnits === 11) {
                        result += ' et onze';
                    } else {
                        result += '-' + this.getTensInFrench(adjustedUnits);
                    }
                } else {
                    result += '-' + this.getTensInFrench(units);
                }
                
                return result;
            }
            
            static getNumberInFrench(num) {
                const numbers = [
                    'zéro', 'un', 'deux', 'trois', 'quatre', 'cinq', 
                    'six', 'sept', 'huit', 'neuf', 'dix'
                ];
                return numbers[num] || num.toString();
            }
        }

        // ==================== 数据存储 ====================
        class DataStorage {
            constructor() {
                this.prefix = 'calendar2026_';
                this.initializeStorage();
            }
            
            initializeStorage() {
                if (!localStorage.getItem(this.prefix + 'initialized')) {
                    const defaultData = {
                        writingEntries: {},
                        exerciseAnswers: {},
                        lastVisit: new Date().toISOString().split('T')[0],
                        settings: {}
                    };
                    localStorage.setItem(this.prefix + 'data', JSON.stringify(defaultData));
                    localStorage.setItem(this.prefix + 'initialized', 'true');
                }
            }
            
            getData() {
                return JSON.parse(localStorage.getItem(this.prefix + 'data') || '{}');
            }
            
            saveData(data) {
                localStorage.setItem(this.prefix + 'data', JSON.stringify(data));
            }
            
            saveWriting(date, content) {
                const data = this.getData();
                data.writingEntries[date] = {
                    content,
                    savedAt: new Date().toISOString()
                };
                this.saveData(data);
                return true;
            }
            
            getWriting(date) {
                const data = this.getData();
                return data.writingEntries[date] || null;
            }
            
            saveExerciseAnswer(date, language, answer, isCorrect) {
                const data = this.getData();
                if (!data.exerciseAnswers[date]) {
                    data.exerciseAnswers[date] = {};
                }
                data.exerciseAnswers[date][language] = {
                    answer,
                    isCorrect,
                    answeredAt: new Date().toISOString()
                };
                this.saveData(data);
            }
            
            getExerciseAnswer(date, language) {
                const data = this.getData();
                return data.exerciseAnswers[date] ? data.exerciseAnswers[date][language] : null;
            }
            
            updateLastVisit(date) {
                const data = this.getData();
                data.lastVisit = date;
                this.saveData(data);
            }
        }

        // ==================== 日期处理 ====================
        class DateManager {
            constructor(year) {
                this.year = year;
                this.currentDate = this.getToday();
            }
            
            getToday() {
                const now = new Date();
                const isDemo = now.getFullYear() !== 2026;
                
                if (isDemo) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const demoDate = urlParams.get('date');
                    
                    if (demoDate) {
                        return new Date(demoDate);
                    } else {
                        return new Date(2026, now.getMonth(), now.getDate());
                    }
                } else {
                    return now;
                }
            }
            
            formatChineseDate(date) {
                const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const weekday = weekdays[date.getDay()];
                
                return `${this.year}年${month}月${day}日 ${weekday}`;
            }
            
            getLunarDate(date) {
                const lunarMonths = ['正月', '二月', '三月', '四月', '五月', '六月', 
                                   '七月', '八月', '九月', '十月', '冬月', '腊月'];
                const lunarDays = ['初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
                                 '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
                                 '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'];
                
                const month = date.getMonth();
                const day = date.getDate();
                
                const lunarMonth = lunarMonths[month % 12];
                const lunarDay = lunarDays[(day - 1) % 30];
                
                return `农历${lunarMonth}${lunarDay}`;
            }
            
            getDayOfYear(date) {
                const start = new Date(date.getFullYear(), 0, 0);
                const diff = date - start;
                const oneDay = 1000 * 60 * 60 * 24;
                return Math.floor(diff / oneDay);
            }
            
            getDateString(date) {
                return date.toISOString().split('T')[0];
            }
            
            changeDate(days) {
                const newDate = new Date(this.currentDate);
                newDate.setDate(newDate.getDate() + days);
                this.currentDate = newDate;
                return this.currentDate;
            }
            
            setToToday() {
                this.currentDate = this.getToday();
                return this.currentDate;
            }
            
            isToday(date) {
                const today = this.getToday();
                return date.toDateString() === today.toDateString();
            }
        }

        // ==================== 数据生成器 ====================
        class DataGenerator {
            constructor() {
                this.englishQuotes = this.initEnglishQuotes();
                this.japaneseQuotes = this.initJapaneseQuotes();
                this.frenchQuotes = this.initFrenchQuotes();
                this.japaneseExercises = this.initJapaneseExercises();
                this.frenchExercises = this.initFrenchExercises();
                this.writingPrompts = this.initWritingPrompts();
            }
            
            initEnglishQuotes() {
                return [
                    {text: "The only way to do great work is to love what you do.", 
                     translation: "做出伟大工作的唯一方法是热爱你所做的事情。",
                     source: "Steve Jobs"},
                    {text: "Be yourself; everyone else is already taken.", 
                     translation: "做你自己，因为别人都有人做了。",
                     source: "Oscar Wilde"},
                    {text: "In the middle of difficulty lies opportunity.", 
                     translation: "在困难之中蕴含着机遇。",
                     source: "Albert Einstein"},
                    {text: "The future belongs to those who believe in the beauty of their dreams.", 
                     translation: "未来属于那些相信自己梦想之美的人。",
                     source: "Eleanor Roosevelt"},
                    {text: "Life is what happens to you while you're busy making other plans.", 
                     translation: "生活就是当你忙于制定其他计划时发生在你身上的事。",
                     source: "John Lennon"}
                ];
            }
            
            initJapaneseQuotes() {
                return [
                    {text: "七転び八起き", 
                     translation: "七次跌倒，八次爬起（喻百折不挠）",
                     source: "日本谚语"},
                    {text: "塵も積もれば山となる", 
                     translation: "积尘成山（积少成多）",
                     source: "日本谚语"},
                    {text: "初心忘るべからず", 
                     translation: "勿忘初心",
                     source: "世阿弥"},
                    {text: "失敗は成功の基", 
                     translation: "失败是成功之母",
                     source: "日本谚语"},
                    {text: "急がば回れ", 
                     translation: "欲速则不达",
                     source: "日本谚语"}
                ];
            }
            
            initFrenchQuotes() {
                return [
                    {text: "Chaque homme doit inventer son chemin.", 
                     translation: "每个人都必须开创自己的道路。",
                     source: "Jean-Paul Sartre"},
                    {text: "La vie, c'est ce qui arrive quand on a d'autres projets.", 
                     translation: "生活就是当你有其他计划时发生的事情。",
                     source: "John Lennon（法语翻译）"},
                    {text: "Vouloir, c'est pouvoir.", 
                     translation: "有志者事竟成。",
                     source: "法国谚语"},
                    {text: "Il n'y a qu'un bonheur dans la vie, c'est d'aimer et d'être aimé.", 
                     translation: "生活中只有一种幸福：爱与被爱。",
                     source: "George Sand"},
                    {text: "La véritable découverte n'est pas de chercher de nouveaux paysages, mais de nouveaux yeux.", 
                     translation: "真正的发现不是寻找新风景，而是拥有新眼光。",
                     source: "Marcel Proust"}
                ];
            }
            
            initJapaneseExercises() {
                return {
                    N3: [
                        {
                            question: "次の文の（　）に入れるのに最もよいものを、1・2・3・4から一つ選びなさい。<br>彼は約束を（　）から、信用できない。",
                            options: ["守りがたい", "守りづらい", "守りかねる", "守りようがない"],
                            answer: 3,
                            explanation: "「〜かねる」表示难以做某事，这里表示难以遵守约定。"
                        },
                        {
                            question: "（　）の言葉に意味が最も近いものを、1・2・3・4から一つ選びなさい。<br>このレポートは明日までに（仕上げる）必要がある。",
                            options: ["完成させる", "書き始める", "提出する", "確認する"],
                            answer: 1,
                            explanation: "「仕上げる」意为完成、做完，与「完成させる」意思最接近。"
                        }
                    ],
                    N2: [
                        {
                            question: "次の文の（　）に入れるのに最もよいものを、1・2・3・4から一つ選びなさい。<br>一度やると決めたからには、最後まで（　）。",
                            options: ["やりぬくべきだ", "やりかねない", "やるわけがない", "やるほかない"],
                            answer: 1,
                            explanation: "「〜からには」表示'既然…就…'，后接应做的事情或决心。"
                        }
                    ],
                    N1: [
                        {
                            question: "次の文の（　）に入れるのに最もよいものを、1・2・3・4から一つ選びなさい。<br>彼の説明は専門的（　）難解で、初心者には理解しがたかった。",
                            options: ["というより", "ながらも", "であれ", "とばかりに"],
                            answer: 1,
                            explanation: "「AというよりB」表示'与其说A不如说B'，这里表示与其说专业不如说难懂。"
                        }
                    ]
                };
            }
            
            initFrenchExercises() {
                return {
                    B1: [
                        {
                            question: "Complétez la phrase: Si j'______ riche, j'achèterais une maison en Provence.",
                            options: ["étais", "serais", "avais été", "serai"],
                            answer: 1,
                            explanation: "在si引导的假设从句中，表示与现在事实相反的假设要用未完成过去时（imparfait）。"
                        }
                    ],
                    B2: [
                        {
                            question: "Choisissez la bonne réponse: Il faut que tu ______ tes devoirs avant de sortir.",
                            options: ["fais", "feras", "fasses", "faisais"],
                            answer: 3,
                            explanation: "在il faut que后面要用虚拟式现在时，faire的虚拟式现在时变位是que je fasse, tu fasses..."
                        }
                    ],
                    C1: [
                        {
                            question: "Sélectionnez le mot qui complète correctement la phrase: ______ eût-il su la vérité, il n'aurait pas agi ainsi.",
                            options: ["Qu'", "Quoi qu'", "Bien qu'", "Si"],
                            answer: 1,
                            explanation: "「Qu'... eût-il su」是倒装结构，相当于「S'il avait su」，表示'如果他早知道'。"
                        }
                    ]
                };
            }
            
            initWritingPrompts() {
                return [
                    {prompt: "描述一个完全由气味构成的记忆。", requirements: "不少于200字，使用至少三种感官类比", theme: "记忆与感官"},
                    {prompt: "写一段对话，其中两个人物都在说谎，但读者能看出真相。", requirements: "不少于200字，包含至少三次对话交替", theme: "对话与真相"},
                    {prompt: "以'如果寂静有颜色'为开头写一段文字。", requirements: "不少于200字，使用比喻和象征手法", theme: "抽象概念"},
                    {prompt: "描述一个你从未去过但感觉熟悉的城市。", requirements: "不少于200字，包含至少三个感官细节", theme: "熟悉与陌生"},
                    {prompt: "写一个关于钥匙的故事，但这把钥匙不是用来开锁的。", requirements: "不少于200字，包含一个意想不到的转折", theme: "象征与隐喻"}
                ];
            }
            
            getEnglishQuote(dayIndex) {
                return this.englishQuotes[dayIndex % this.englishQuotes.length];
            }
            
            getJapaneseQuote(dayIndex) {
                return this.japaneseQuotes[dayIndex % this.japaneseQuotes.length];
            }
            
            getFrenchQuote(dayIndex) {
                return this.frenchQuotes[dayIndex % this.frenchQuotes.length];
            }
            
            getJapaneseExercise(dayIndex) {
                let difficulty;
                if (dayIndex < 120) difficulty = "N3";
                else if (dayIndex < 240) difficulty = "N2";
                else difficulty = "N1";
                
                const exercises = this.japaneseExercises[difficulty];
                const exercise = exercises[dayIndex % exercises.length];
                return {...exercise, difficulty};
            }
            
            getFrenchExercise(dayIndex) {
                let difficulty;
                if (dayIndex < 120) difficulty = "B1";
                else if (dayIndex < 240) difficulty = "B2";
                else difficulty = "C1";
                
                const exercises = this.frenchExercises[difficulty];
                const exercise = exercises[dayIndex % exercises.length];
                return {...exercise, difficulty};
            }
            
            getWritingPrompt(dayIndex) {
                return this.writingPrompts[dayIndex % this.writingPrompts.length];
            }
        }

        // ==================== 主应用 ====================
        class CalendarApp {
            constructor() {
                this.storage = new DataStorage();
                this.dateManager = new DateManager(CONFIG.year);
                this.generator = new DataGenerator();
                this.currentDate = this.dateManager.currentDate;
                
                this.selectedJapaneseAnswer = null;
                this.selectedFrenchAnswer = null;
                this.isJapaneseAnswered = false;
                this.isFrenchAnswered = false;
                
                this.calendarYear = 2026;
                this.calendarMonth = this.currentDate.getMonth();
                this.isCalendarVisible = false;
                
                this.initializeApp();
                this.loadDate(this.currentDate);
                this.setupEventListeners();
                this.startAutoUpdate();
            }
            
            initializeApp() {
                document.getElementById('last-updated').textContent = 
                    new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
                
                const todayStr = this.dateManager.getDateString(this.dateManager.getToday());
                const data = this.storage.getData();
                if (data.lastVisit !== todayStr) {
                    this.showNotification(`欢迎回来！今天是${this.dateManager.formatChineseDate(this.dateManager.getToday())}`);
                    this.storage.updateLastVisit(todayStr);
                }
            }
            
            loadDate(date) {
                const dateStr = this.dateManager.getDateString(date);
                const dayOfYear = this.dateManager.getDayOfYear(date);
                
                // 更新日期显示
                document.getElementById('today-date').textContent = this.dateManager.formatChineseDate(date);
                
                const japaneseDate = JapaneseDateFormatter.getJapaneseDate(date);
                document.getElementById('date-japanese-full').textContent = 
                    `${date.getFullYear()}年${date.getMonth()+1}月${date.getDate()}日（${japaneseDate.numeric.split('（')[1].replace('）', '')}）`;
                document.getElementById('date-japanese').textContent = japaneseDate.kana;
                
                const frenchDate = FrenchDateFormatter.getFrenchDate(date);
                document.getElementById('date-french-full').textContent = frenchDate.numeric;
                document.getElementById('date-french').textContent = frenchDate.spelled;
                
                document.getElementById('today-lunar').textContent = this.dateManager.getLunarDate(date);
                
                // 更新进度条
                const progressPercent = (dayOfYear / 365) * 100;
                document.getElementById('year-progress').style.width = `${progressPercent}%`;
                document.getElementById('day-counter').textContent = `第 ${dayOfYear} 天 / 共 365 天`;
                
                // 获取学习数据
                const englishQuote = this.generator.getEnglishQuote(dayOfYear);
                const japaneseQuote = this.generator.getJapaneseQuote(dayOfYear);
                const frenchQuote = this.generator.getFrenchQuote(dayOfYear);
                const japaneseExercise = this.generator.getJapaneseExercise(dayOfYear);
                const frenchExercise = this.generator.getFrenchExercise(dayOfYear);
                const writingPrompt = this.generator.getWritingPrompt(dayOfYear);
                
                // 更新英语名言
                document.getElementById('english-quote').textContent = englishQuote.text;
                document.getElementById('english-translation').textContent = englishQuote.translation;
                document.getElementById('english-source').textContent = `— ${englishQuote.source}`;
                
                // 更新日语部分
                document.getElementById('japanese-quote').textContent = japaneseQuote.text;
                document.getElementById('japanese-translation').textContent = japaneseQuote.translation;
                document.getElementById('japanese-source').textContent = `— ${japaneseQuote.source}`;
                document.getElementById('japanese-difficulty').textContent = japaneseExercise.difficulty;
                document.getElementById('japanese-question').innerHTML = japaneseExercise.question;
                
                this.updateOptions('japanese', japaneseExercise.options, dateStr);
                document.getElementById('japanese-explanation').innerHTML = 
                    `<strong>正确答案：${japaneseExercise.answer}</strong><br>
                    <strong>解析：</strong>${japaneseExercise.explanation}`;
                
                // 更新法语部分
                document.getElementById('french-quote').textContent = frenchQuote.text;
                document.getElementById('french-translation').textContent = frenchQuote.translation;
                document.getElementById('french-source').textContent = `— ${frenchQuote.source}`;
                document.getElementById('french-difficulty').textContent = frenchExercise.difficulty;
                document.getElementById('french-question').textContent = frenchExercise.question;
                
                this.updateOptions('french', frenchExercise.options, dateStr);
                document.getElementById('french-explanation').innerHTML = 
                    `<strong>正确答案：${frenchExercise.answer}</strong><br>
                    <strong>解析：</strong>${frenchExercise.explanation}`;
                
                // 更新创意写作
                document.getElementById('writing-prompt').textContent = writingPrompt.prompt;
                document.getElementById('writing-requirements').innerHTML = 
                    `<strong>要求：</strong>${writingPrompt.requirements}<br>
                    <strong>主题：</strong>${writingPrompt.theme}`;
                
                // 加载已保存的写作内容
                const savedWriting = this.storage.getWriting(dateStr);
                document.getElementById('writing-text').value = savedWriting ? savedWriting.content : '';
                
                // 更新写作状态
                this.updateWritingStatus(savedWriting);
                
                // 更新按钮状态
                this.updateNavButtons();
                
                // 重置练习选择状态
                this.resetExerciseSelection();
                
                // 如果日历视图是可见的，更新它
                if (this.isCalendarVisible) {
                    this.renderCalendar(this.calendarYear, this.calendarMonth);
                }
            }
            
            updateOptions(language, options, dateStr) {
                const optionsContainer = document.getElementById(`${language}-options`);
                optionsContainer.innerHTML = '';
                
                const savedAnswer = this.storage.getExerciseAnswer(dateStr, language);
                
                options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.dataset.value = index + 1;
                    
                    const optionNumber = document.createElement('span');
                    optionNumber.className = 'option-number';
                    optionNumber.textContent = index + 1;
                    
                    const optionText = document.createElement('span');
                    optionText.textContent = option;
                    
                    optionDiv.appendChild(optionNumber);
                    optionDiv.appendChild(optionText);
                    
                    if (savedAnswer && savedAnswer.answer === (index + 1).toString()) {
                        optionDiv.classList.add('selected');
                        if (savedAnswer.isCorrect) {
                            optionDiv.classList.add('correct-answer');
                        } else {
                            optionDiv.classList.add('wrong-answer');
                        }
                        
                        const feedbackElement = document.getElementById(`${language}-feedback`);
                        if (savedAnswer.isCorrect) {
                            feedbackElement.textContent = '回答正确！';
                            feedbackElement.className = 'exercise-feedback correct-feedback';
                        } else {
                            feedbackElement.textContent = '回答错误，请查看解析';
                            feedbackElement.className = 'exercise-feedback wrong-feedback';
                        }
                        feedbackElement.style.display = 'block';
                        
                        document.getElementById(`check-${language}`).disabled = true;
                        
                        if (language === 'japanese') {
                            this.isJapaneseAnswered = true;
                            this.selectedJapaneseAnswer = index + 1;
                        } else {
                            this.isFrenchAnswered = true;
                            this.selectedFrenchAnswer = index + 1;
                        }
                    }
                    
                    optionsContainer.appendChild(optionDiv);
                });
            }
            
            updateWritingStatus(savedWriting) {
                const statusElement = document.getElementById('writing-status');
                if (savedWriting) {
                    const savedTime = new Date(savedWriting.savedAt).toLocaleTimeString('zh-CN', 
                        {hour: '2-digit', minute: '2-digit'});
                    statusElement.textContent = `已保存于 ${savedTime}`;
                    statusElement.className = 'completed';
                } else {
                    statusElement.textContent = '未保存';
                    statusElement.className = '';
                }
            }
            
            resetExerciseSelection() {
                if (!this.isJapaneseAnswered) this.selectedJapaneseAnswer = null;
                if (!this.isFrenchAnswered) this.selectedFrenchAnswer = null;
            }
            
            updateNavButtons() {
                const isToday = this.dateManager.isToday(this.currentDate);
                document.getElementById('today-btn').disabled = isToday;
            }
            
            showNotification(message) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            // 日历视图功能
            toggleCalendarView() {
                this.isCalendarVisible = !this.isCalendarVisible;
                const calendarView = document.getElementById('calendar-view');
                const toggleBtn = document.getElementById('toggle-calendar');
                
                if (this.isCalendarVisible) {
                    calendarView.style.display = 'block';
                    toggleBtn.innerHTML = '<i class="fas fa-times"></i> 隐藏日历';
                    this.renderCalendar(this.calendarYear, this.calendarMonth);
                } else {
                    calendarView.style.display = 'none';
                    toggleBtn.innerHTML = '<i class="fas fa-calendar-alt"></i> 查看学习日历';
                }
            }
            
            renderCalendar(year, month) {
                this.calendarYear = year;
                this.calendarMonth = month;
                
                document.getElementById('calendar-month').textContent = 
                    `${year}年${month + 1}月`;
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const firstDayOfWeek = firstDay.getDay();
                
                const data = this.storage.getData();
                const writingEntries = data.writingEntries || {};
                const exerciseAnswers = data.exerciseAnswers || {};
                
                let calendarHTML = '';
                
                // 填充上个月的空白
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const prevMonthDay = new Date(year, month, -i);
                    calendarHTML += this.getCalendarDayHTML(prevMonthDay, false, writingEntries, exerciseAnswers);
                }
                
                // 填充当前月的日期
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    calendarHTML += this.getCalendarDayHTML(date, true, writingEntries, exerciseAnswers);
                }
                
                // 填充下个月的空白
                const totalCells = 42;
                const filledCells = firstDayOfWeek + daysInMonth;
                const remainingCells = totalCells - filledCells;
                
                for (let i = 1; i <= remainingCells; i++) {
                    const nextMonthDay = new Date(year, month + 1, i);
                    calendarHTML += this.getCalendarDayHTML(nextMonthDay, false, writingEntries, exerciseAnswers);
                }
                
                document.getElementById('calendar-days').innerHTML = calendarHTML;
                this.addCalendarDayClickEvents();
            }
            
            getCalendarDayHTML(date, isCurrentMonth, writingEntries, exerciseAnswers) {
                const dateStr = this.dateManager.getDateString(date);
                const dayNum = date.getDate();
                const isToday = this.dateManager.isToday(date);
                
                const hasWriting = writingEntries[dateStr];
                const hasJapanese = exerciseAnswers[dateStr] && exerciseAnswers[dateStr].japanese;
                const hasFrench = exerciseAnswers[dateStr] && exerciseAnswers[dateStr].french;
                
                let statusClass = '';
                if (hasWriting && (hasJapanese || hasFrench)) {
                    statusClass = 'completed';
                } else if (hasWriting || hasJapanese || hasFrench) {
                    statusClass = 'partial';
                } else if (hasWriting) {
                    statusClass = 'has-writing';
                } else if (hasJapanese || hasFrench) {
                    statusClass = 'has-exercises';
                }
                
                let indicators = '';
                if (hasWriting || hasJapanese || hasFrench) {
                    indicators = '<div class="day-indicators">';
                    if (hasWriting) indicators += '<span class="indicator-writing">✏️</span>';
                    if (hasJapanese) indicators += '<span class="indicator-japanese">🇯🇵</span>';
                    if (hasFrench) indicators += '<span class="indicator-french">🇫🇷</span>';
                    indicators += '</div>';
                }
                
                return `
                    <div class="calendar-day ${isCurrentMonth ? 'current-month' : 'other-month'} 
                                           ${isToday ? 'today' : ''} 
                                           ${statusClass}"
                         data-date="${dateStr}">
                        ${dayNum}
                        ${indicators}
                    </div>
                `;
            }
            
            addCalendarDayClickEvents() {
                document.querySelectorAll('.calendar-day.current-month').forEach(day => {
                    day.addEventListener('click', () => {
                        const dateStr = day.dataset.date;
                        this.currentDate = new Date(dateStr);
                        this.loadDate(this.currentDate);
                        
                        if (this.isCalendarVisible) {
                            this.toggleCalendarView();
                        }
                        
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    });
                });
            }
            
            setupCalendarNavigation() {
                document.getElementById('prev-calendar-month').addEventListener('click', () => {
                    this.calendarMonth--;
                    if (this.calendarMonth < 0) {
                        this.calendarMonth = 11;
                        this.calendarYear--;
                    }
                    this.renderCalendar(this.calendarYear, this.calendarMonth);
                });
                
                document.getElementById('next-calendar-month').addEventListener('click', () => {
                    this.calendarMonth++;
                    if (this.calendarMonth > 11) {
                        this.calendarMonth = 0;
                        this.calendarYear++;
                    }
                    this.renderCalendar(this.calendarYear, this.calendarMonth);
                });
            }
            
            setupEventListeners() {
                // 导航按钮
                document.getElementById('prev-day').addEventListener('click', () => {
                    this.currentDate = this.dateManager.changeDate(-1);
                    this.loadDate(this.currentDate);
                    this.resetAnswerState();
                });
                
                document.getElementById('next-day').addEventListener('click', () => {
                    this.currentDate = this.dateManager.changeDate(1);
                    this.loadDate(this.currentDate);
                    this.resetAnswerState();
                });
                
                document.getElementById('today-btn').addEventListener('click', () => {
                    this.currentDate = this.dateManager.setToToday();
                    this.loadDate(this.currentDate);
                    this.resetAnswerState();
                });
                
                // 日语练习选项选择
                document.getElementById('japanese-options').addEventListener('click', (e) => {
                    if (this.isJapaneseAnswered) return;
                    
                    const option = e.target.closest('.option');
                    if (option) {
                        document.querySelectorAll('#japanese-options .option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        option.classList.add('selected');
                        this.selectedJapaneseAnswer = parseInt(option.dataset.value);
                    }
                });
                
                // 法语练习选项选择
                document.getElementById('french-options').addEventListener('click', (e) => {
                    if (this.isFrenchAnswered) return;
                    
                    const option = e.target.closest('.option');
                    if (option) {
                        document.querySelectorAll('#french-options .option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        option.classList.add('selected');
                        this.selectedFrenchAnswer = parseInt(option.dataset.value);
                    }
                });
                
                // 检查答案按钮
                document.getElementById('check-japanese').addEventListener('click', () => {
                    this.checkAnswer('japanese');
                });
                
                document.getElementById('check-french').addEventListener('click', () => {
                    this.checkAnswer('french');
                });
                
                // 显示解析按钮
                document.getElementById('show-japanese-explanation').addEventListener('click', () => {
                    document.getElementById('japanese-explanation').style.display = 'block';
                });
                
                document.getElementById('show-french-explanation').addEventListener('click', () => {
                    document.getElementById('french-explanation').style.display = 'block';
                });
                
                // 重置按钮
                document.getElementById('reset-japanese').addEventListener('click', () => {
                    this.resetExercise('japanese');
                });
                
                document.getElementById('reset-french').addEventListener('click', () => {
                    this.resetExercise('french');
                });
                
                // 保存写作按钮
                document.getElementById('save-writing').addEventListener('click', () => {
                    this.saveWriting();
                });
                
                // 自动保存写作
                let saveTimeout;
                document.getElementById('writing-text').addEventListener('input', () => {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(() => {
                        this.saveWriting(true);
                    }, 30000);
                });
                
                // 日历切换
                document.getElementById('toggle-calendar').addEventListener('click', () => {
                    this.toggleCalendarView();
                });
                
                // 日历月份导航
                this.setupCalendarNavigation();
            }
            
            resetAnswerState() {
                this.selectedJapaneseAnswer = null;
                this.selectedFrenchAnswer = null;
                this.isJapaneseAnswered = false;
                this.isFrenchAnswered = false;
            }
            
            checkAnswer(language) {
                const selectedAnswer = language === 'japanese' ? this.selectedJapaneseAnswer : this.selectedFrenchAnswer;
                
                if (!selectedAnswer) {
                    this.showNotification('请先选择一个答案！');
                    return;
                }
                
                const explanationElement = document.getElementById(`${language}-explanation`);
                const answerMatch = explanationElement.innerHTML.match(/正确答案：(\d)/);
                if (!answerMatch) return;
                
                const correctAnswer = parseInt(answerMatch[1]);
                const isCorrect = selectedAnswer === correctAnswer;
                const dateStr = this.dateManager.getDateString(this.currentDate);
                
                this.storage.saveExerciseAnswer(dateStr, language, selectedAnswer.toString(), isCorrect);
                
                const options = document.querySelectorAll(`#${language}-options .option`);
                const feedbackElement = document.getElementById(`${language}-feedback`);
                
                options.forEach(option => {
                    const optionValue = parseInt(option.dataset.value);
                    if (optionValue === selectedAnswer) {
                        if (isCorrect) {
                            option.classList.add('correct-answer');
                            feedbackElement.textContent = '回答正确！';
                            feedbackElement.className = 'exercise-feedback correct-feedback';
                        } else {
                            option.classList.add('wrong-answer');
                            feedbackElement.textContent = '回答错误，请查看解析';
                            feedbackElement.className = 'exercise-feedback wrong-feedback';
                        }
                        feedbackElement.style.display = 'block';
                    }
                    
                    if (optionValue === correctAnswer && !isCorrect) {
                        option.classList.add('correct-answer');
                    }
                });
                
                document.getElementById(`check-${language}`).disabled = true;
                
                if (language === 'japanese') {
                    this.isJapaneseAnswered = true;
                } else {
                    this.isFrenchAnswered = true;
                }
                
                explanationElement.style.display = 'block';
                
                if (isCorrect) {
                    this.showNotification('回答正确！');
                } else {
                    this.showNotification('回答错误，请查看解析');
                }
                
                // 更新日历视图
                if (this.isCalendarVisible) {
                    this.renderCalendar(this.calendarYear, this.calendarMonth);
                }
            }
            
            resetExercise(language) {
                const options = document.querySelectorAll(`#${language}-options .option`);
                options.forEach(option => {
                    option.classList.remove('selected', 'correct-answer', 'wrong-answer');
                });
                
                document.getElementById(`${language}-feedback`).style.display = 'none';
                document.getElementById(`${language}-explanation`).style.display = 'none';
                document.getElementById(`check-${language}`).disabled = false;
                
                if (language === 'japanese') {
                    this.selectedJapaneseAnswer = null;
                    this.isJapaneseAnswered = false;
                } else {
                    this.selectedFrenchAnswer = null;
                    this.isFrenchAnswered = false;
                }
                
                const dateStr = this.dateManager.getDateString(this.currentDate);
                const data = this.storage.getData();
                if (data.exerciseAnswers && data.exerciseAnswers[dateStr]) {
                    delete data.exerciseAnswers[dateStr][language];
                    this.storage.saveData(data);
                }
                
                if (this.isCalendarVisible) {
                    this.renderCalendar(this.calendarYear, this.calendarMonth);
                }
                
                this.showNotification(`${language === 'japanese' ? '日语' : '法语'}练习已重置`);
            }
            
            saveWriting(auto = false) {
                const content = document.getElementById('writing-text').value;
                const dateStr = this.dateManager.getDateString(this.currentDate);
                
                if (content.trim() === '') {
                    if (!auto) this.showNotification('写作内容不能为空！');
                    return;
                }
                
                const success = this.storage.saveWriting(dateStr, content);
                
                if (success) {
                    const savedWriting = this.storage.getWriting(dateStr);
                    this.updateWritingStatus(savedWriting);
                    
                    if (this.isCalendarVisible) {
                        this.renderCalendar(this.calendarYear, this.calendarMonth);
                    }
                    
                    if (!auto) {
                        this.showNotification('写作已保存！');
                    }
                }
            }
            
            startAutoUpdate() {
                setInterval(() => {
                    const now = new Date();
                    document.getElementById('last-updated').textContent = 
                        now.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
                    
                    if (now.getDate() !== this.currentDate.getDate() && 
                        this.dateManager.isToday(this.currentDate)) {
                        this.currentDate = this.dateManager.setToToday();
                        this.loadDate(this.currentDate);
                        this.resetAnswerState();
                        this.showNotification('新的一天开始！已自动跳转到今天。');
                    }
                }, 300000);
            }
        }

        // ==================== 初始化应用 ====================
        document.addEventListener('DOMContentLoaded', () => {
            const app = new CalendarApp();
            
            window.calendarApp = app;
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' && !e.target.matches('textarea, input')) {
                    app.currentDate = app.dateManager.changeDate(-1);
                    app.loadDate(app.currentDate);
                    app.resetAnswerState();
                    e.preventDefault();
                }
                else if (e.key === 'ArrowRight' && !e.target.matches('textarea, input')) {
                    app.currentDate = app.dateManager.changeDate(1);
                    app.loadDate(app.currentDate);
                    app.resetAnswerState();
                    e.preventDefault();
                }
                else if (e.key === 't' && !e.target.matches('textarea, input')) {
                    app.currentDate = app.dateManager.setToToday();
                    app.loadDate(app.currentDate);
                    app.resetAnswerState();
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>