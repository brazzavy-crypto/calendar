<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è¯­è¨€ç²¾è¿›æ—¥å†</title>
    <style>
        :root { --gold: #b8860b; --bg: #fdfaf2; --accent: #603; --done: #28a745; }
        body { font-family: 'STSong', 'PingFang SC', serif; background: #eee; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .calendar-nav { display: grid; grid-template-columns: repeat(11, 1fr); gap: 4px; margin-bottom: 15px; background: #fff; padding: 8px; border-radius: 6px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .cal-dot { width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; border: 1px solid #eee; border-radius: 4px; color: #999; position: relative; }
        .cal-dot.active { border: 1px solid var(--gold); background: #fff9eb; color: var(--gold); font-weight: bold; }
        .cal-dot.completed::after { content: ''; width: 4px; height: 4px; background: var(--done); border-radius: 50%; position: absolute; bottom: 1px; }
        
        .container { background: var(--bg); max-width: 600px; width: 100%; padding: 25px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); box-sizing: border-box; }
        .date-header { text-align: center; border-bottom: 1px solid #ddd; margin-bottom: 20px; padding-bottom: 10px; }
        .date-main { font-size: 1.3em; font-weight: bold; margin: 0; color: #333; }
        .date-sub { font-size: 0.8em; color: #666; margin: 4px 0; line-height: 1.5; }
        
        .section-title { border-left: 3px solid var(--gold); padding-left: 8px; margin: 20px 0 10px; font-weight: bold; font-size: 0.95em; color: #444; }
        .quote-item { margin-bottom: 12px; }
        .quote-text { font-size: 0.95em; line-height: 1.4; color: #111; font-weight: 500; }
        .quote-cn { font-size: 0.85em; color: #666; margin-top: 2px; font-style: italic; }
        
        .exercise-container { background: rgba(0,0,0,0.02); padding: 12px; border-radius: 4px; margin-bottom: 10px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .opt-btn { padding: 10px; border: 1px solid #ccc; background: white; cursor: pointer; border-radius: 4px; font-size: 0.85em; text-align: left; }
        .opt-btn.correct { background: #d4edda !important; border-color: #28a745 !important; }
        .opt-btn.wrong { background: #f8d7da !important; border-color: #dc3545 !important; }
        
        textarea { width: 100%; height: 75px; margin-top: 8px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; box-sizing: border-box; font-size: 13px; background: rgba(255,255,255,0.5); font-family: inherit; }
.ans-show {
    margin-top: 10px;
    font-size: 0.95em;
    line-height: 1.8;
    color: #444;
    padding: 15px;
    background: #fdfaf2;
    border-radius: 6px;
    border: 1px solid #eee;
    white-space: pre-wrap; /* ä¿æŒèŒƒæ–‡çš„æ¢è¡Œæ ¼å¼ */
    word-wrap: break-word;
}
        .secret-trigger { height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #ddd; font-size: 14px; margin-top: 10px; }
        .hidden-content { display: none; }
        ruby rt { font-size: 0.6em; color: var(--gold); }

/* åº•éƒ¨æŒ‰é’®åŒº - ç®€æ´æ¨ªæ’ç‰ˆ */
.admin-btns { 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    gap: 8px; 
    margin-top: 40px; 
    padding-top: 20px; 
    border-top: 1px dashed #ddd; 
}
.report-btn { 
    background: var(--accent); 
    color: white; 
    border: none; 
    padding: 8px 14px; 
    border-radius: 6px; 
    cursor: pointer; 
    font-weight: bold; 
    font-size: 12px; 
}
.secondary-btn { 
    background: #f8f8f8; 
    color: #666; 
    border: 1px solid #ddd; 
    padding: 8px 12px; 
    border-radius: 6px; 
    font-size: 12px; 
    cursor: pointer; 
}

/* é‰´èµæŒ‰é’®ï¼šå¤å…¸æ·±çº¢è‰²é£æ ¼ */
.btn-reading {
    border-color: #722f37 !important; /* å‹ƒè‰®ç¬¬é…’çº¢ */
    color: #722f37 !important;
    background: #fffafa !important;
    font-weight: bold;
    letter-spacing: 1px;
}

/* é‰´èµæ¡†å†…éƒ¨æ’ç‰ˆï¼šä¸­è‹±æ–‡åŒºåˆ† */
.reading-text-en { color: #333; font-family: 'Georgia', serif; margin-bottom: 20px; }
.reading-text-cn { color: #666; border-top: 1px dashed #ccc; padding-top: 15px; }
    </style>
</head>
<body>

<div id="calendar-view" class="calendar-nav"></div>

<div class="container">
    <div class="date-header">
        <h1 class="date-main" id="date-cn">åŠ è½½ä¸­...</h1>
        <p class="date-sub" id="date-lang-sub"></p>
        <p id="lunar-info" style="color:var(--gold); font-size:0.85em; font-weight:bold; margin-top:5px;"></p>
    </div>

    <div class="quote-box">
        <div class="quote-item">
            <div class="quote-text"><strong>EN:</strong> <span id="en_q"></span></div>
            <div class="quote-cn" id="en_cn"></div>
        </div>
        <div class="quote-item">
            <div class="quote-text"><strong>JP:</strong> <span id="jp_q"></span></div>
            <div class="quote-cn" id="jp_cn"></div>
        </div>
        <div class="quote-item">
            <div class="quote-text"><strong>FR:</strong> <span id="fr_q"></span></div>
            <div class="quote-cn" id="fr_cn"></div>
        </div>
    </div>

    <div id="exercises-area">
        <div class="section-title">è¯­è¨€è¿›é˜¶ç»ƒä¹ </div>
        <div class="exercise-container">
            <p><strong>æ—¥æœ¬èª:</strong> <span id="jp_ex_q"></span></p>
            <div id="jp_input_area"></div>
        </div>
        <div class="exercise-container">
            <p><strong>FranÃ§ais:</strong> <span id="fr_ex_q"></span></p>
            <div id="fr_input_area"></div>
        </div>
    </div>

    <div class="section-title">åˆ›ä½œè¡¨è¾¾</div>
    <div class="exercise-container">
        <p id="write_c_q" style="font-size:0.9em; margin-bottom:5px;"></p>
        <textarea id="write_c_input" oninput="saveCurrentData()" placeholder="å¼€å§‹å†™ä½œ..."></textarea>
    </div>

    <div class="secret-trigger" onclick="toggleAdult()">â™¢</div>
    <div class="hidden-content" id="adult-content">
        <div class="exercise-container" style="border-top: 1px solid var(--accent);">
            <p id="write_a_q" style="font-size:0.9em; margin-bottom:5px; font-weight:bold; color:var(--accent);"></p>
            <textarea id="write_a_input" oninput="saveCurrentData()" placeholder="ç§å¯†å†™ä½œ..."></textarea>
        </div>
    </div>

<div class="admin-btns">
    <button class="report-btn" onclick="generateWeeklyReport()">ğŸ“Š æœ¬å‘¨è¯„å®¡</button>
    <button class="secondary-btn" onclick="exportData()">ğŸ’¾ å¤‡ä»½</button>
    <button class="secondary-btn" onclick="document.getElementById('importFile').click()">ğŸ“‚ è¿˜åŸ</button>
    <input type="file" id="importFile" style="display:none" onchange="importData(event)">
</div>
</div>

<textarea id="copy-temp" style="position:absolute; left:-9999px;"></textarea>

<script src="data.js"></script>

<script>
    // è¿™é‡Œæ˜¯ä½ åŸæœ¬çš„é€»è¾‘ä»£ç ï¼ˆæ¯”å¦‚ç”Ÿæˆè±å½¢ã€å¤„ç†ç‚¹å‡»äº‹ä»¶ç­‰ï¼‰
    // åªè¦ä¸Šé¢å¼•å…¥äº† data.jsï¼Œè¿™é‡Œçš„ä»£ç ä¾ç„¶å¯ä»¥è¯»å–åˆ° calendarData

let currentShowingDate = "2026-01-01";
let userStorage = JSON.parse(localStorage.getItem('cal_progress_2026')) || {};

function init() {
    renderCalendarNav();
    loadDate(currentShowingDate);
}

function loadDate(dStr) {
    currentShowingDate = dStr;
    const data = calendarData.find(x => x.date === dStr);
    if(!data) return;
    const saved = userStorage[dStr] || {};

    // åŸºç¡€ä¿¡æ¯æ¸²æŸ“
    document.getElementById('date-cn').innerText = `${data.date.split('-')[1]}æœˆ${data.date.split('-')[2]}æ—¥ ${data.week_cn || ''}`;
    document.getElementById('date-lang-sub').innerHTML = `${data.date_fr}<br>${data.date_jp}`;
    document.getElementById('lunar-info').innerText = data.lunar;

    // åè¨€æ¸²æŸ“
    document.getElementById('en_q').innerText = data.en_q;
    document.getElementById('en_cn').innerText = data.en_cn || "";
    document.getElementById('jp_q').innerHTML = data.jp_q;
    document.getElementById('jp_cn').innerText = data.jp_cn || "";
    document.getElementById('fr_q').innerText = data.fr_q;
    document.getElementById('fr_cn').innerText = data.fr_cn || "";

    // ä¹ é¢˜æ¸²æŸ“
    renderFlexibleEx('jp', data.jp_ex, data.jp_ans, saved);
    renderFlexibleEx('fr', data.fr_ex, data.fr_ans, saved);

    // å†™ä½œåŒºæ¸²æŸ“
    document.getElementById('write_c_q').innerText = data.write_c;
    document.getElementById('write_c_input').value = saved.write_c || '';
    document.getElementById('write_a_q').innerText = data.write_a;
    document.getElementById('write_a_input').value = saved.write_a || '';
    
    // --- éšè—åŒºæ‰©å±•æ¨¡å— (èŒƒæ–‡ & é‰´èµ) ---
    const adultArea = document.getElementById('adult-content');
    const oldExtra = adultArea.querySelector('.extra-wrap');
    if(oldExtra) oldExtra.remove();

    const extraWrap = document.createElement('div');
    extraWrap.className = 'extra-wrap';
    extraWrap.style.marginTop = "10px";

    // 1. èŒƒæ–‡åŠŸèƒ½
    if(data.write_a_sample) {
        const sampleBtn = document.createElement('button');
        sampleBtn.className = 'secondary-btn';
        sampleBtn.style = "padding: 4px 10px; font-size: 11px; border-color:var(--accent); color:var(--accent); margin-right:8px;";
        sampleBtn.innerText = "èŒƒæ–‡";

        const sampleContent = document.createElement('div');
        sampleContent.className = 'ans-show';
        sampleContent.style.display = 'none';
        sampleContent.innerHTML = `<div style="color:var(--accent); font-weight:bold; margin-bottom:5px;">å‚è€ƒèŒƒæ–‡ï¼š</div>${data.write_a_sample}`;

        sampleBtn.onclick = () => {
            sampleContent.style.display = sampleContent.style.display === 'none' ? 'block' : 'none';
        };
        extraWrap.appendChild(sampleBtn);
        extraWrap.appendChild(sampleContent);
    }

    // 2. é‰´èµåŠŸèƒ½
		if(data.daily_reading) {
        const readBtn = document.createElement('button');
        readBtn.className = 'secondary-btn';
        readBtn.style = "padding: 4px 10px; font-size: 11px; border-color:#966; color:#966;";
        readBtn.innerText = "é‰´èµ";

        const readContent = document.createElement('div');
        readContent.className = 'ans-show';
        readContent.style.display = 'none';
        readContent.style.borderLeft = "3px solid #966";
        
        // --- ä¿®æ”¹ç‚¹ï¼šåœ¨è¿™é‡Œæ‹¼æ¥â€œé‰´èµæ­£æ–‡â€å’Œâ€œæ¨¡ä»¿æŒ‘æˆ˜â€ ---
        let htmlBuffer = `<div style="color:#966; font-weight:bold; margin-bottom:5px;">æ–‡å­¦ç‰‡æ®µé‰´èµï¼š</div>${data.daily_reading}`;
        
        // å¦‚æœæ•°æ®é‡Œæœ‰æ¨¡ä»¿é¢˜ï¼Œå°±æ¥åœ¨åé¢
        if (data.mimic_task) {
            htmlBuffer += `
                <div style="margin-top:15px; padding:10px; border-top:1px dashed #966; background:rgba(150,102,102,0.05);">
                    <div style="color:#966; font-weight:bold; font-size:12px; margin-bottom:4px;">âœï¸ è¿›é˜¶æ„Ÿå®˜æ¨¡ä»¿æŒ‘æˆ˜ï¼š</div>
                    <div style="color:#444; font-size:13px; line-height:1.5;">${data.mimic_task}</div>
                </div>`;
        }
        
        readContent.innerHTML = htmlBuffer;
        // ------------------------------------------

        readBtn.onclick = () => {
            readContent.style.display = readContent.style.display === 'none' ? 'block' : 'none';
        };
        extraWrap.appendChild(readBtn);
        extraWrap.appendChild(readContent);
    }

    adultArea.appendChild(extraWrap);

    // é‡ç½®çŠ¶æ€
    document.getElementById('adult-content').style.display = 'none';
    renderCalendarNav();
}

function renderFlexibleEx(lang, rawEx, correctAns, saved) {
    const qEl = document.getElementById(lang + '_ex_q');
    const area = document.getElementById(lang + '_input_area');
    area.innerHTML = '';
    
    // è·å–å½“å‰æ—¥æœŸçš„æ•°æ®å¯¹è±¡ï¼Œä»¥ä¾¿è¯»å– tips
    const data = calendarData.find(x => x.date === currentShowingDate);
    const tips = (lang === 'jp' ? data.jp_ans_tips : data.fr_ans_tips) || "";

    if (rawEx.includes('A.')) {
        const parts = rawEx.split(/[A-D]\./);
        qEl.innerHTML = parts[0];
        const opts = rawEx.match(/[A-D]\.[^A-D]+/g) || [];
        const grid = document.createElement('div');
        grid.className = 'options-grid';
        
        // åˆ›å»ºä¸€ä¸ªç”¨äºæ˜¾ç¤ºé€‰æ‹©é¢˜è§£æçš„å®¹å™¨
        const tipEl = document.createElement('div');
        tipEl.className = 'ans-show';
        tipEl.style.marginTop = "10px";

        opts.forEach(optStr => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = optStr.trim();
            const char = optStr.trim().charAt(0);
            
            if(saved[lang + '_choice']) {
                if(char === correctAns) btn.classList.add('correct');
                if(saved[lang + '_choice'] === char && char !== correctAns) btn.classList.add('wrong');
                tipEl.innerHTML = `<strong>è§£æï¼š</strong>${tips}`;
                tipEl.style.display = 'block';
            } else {
                btn.onclick = () => {
                    if(char === correctAns) btn.classList.add('correct');
                    else {
                        btn.classList.add('wrong');
                        Array.from(grid.children).forEach(b => {
                            if(b.innerText.trim().startsWith(correctAns)) b.classList.add('correct');
                        });
                    }
                    saveCurrentData(lang + '_choice', char);
                    tipEl.innerHTML = `<strong>è§£æï¼š</strong>${tips}`;
                    tipEl.style.display = 'block';
                };
            }
            grid.appendChild(btn);
        });
        area.appendChild(grid);
        area.appendChild(tipEl);
    } else {
        qEl.innerHTML = rawEx;
        const txt = document.createElement('textarea');
        txt.value = saved[lang + '_text'] || '';
        txt.oninput = (e) => saveCurrentData(lang + '_text', e.target.value);
        
        const ansBtn = document.createElement('button');
        ansBtn.innerText = "æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ";
        ansBtn.style = "margin-top:5px; font-size:11px; cursor:pointer;";
        
        const ansDiv = document.createElement('div');
        ansDiv.className = 'ans-show';
        // è¿™é‡ŒåŒæ—¶æ˜¾ç¤º ç­”æ¡ˆ å’Œ è§£æ
        ansDiv.innerHTML = `<strong>å‚è€ƒç­”æ¡ˆï¼š</strong>${correctAns}<br><br><strong>è§£æï¼š</strong>${tips}`;
        
        ansBtn.onclick = () => { ansDiv.style.display = 'block'; };
        
        area.appendChild(txt);
        area.appendChild(ansBtn);
        area.appendChild(ansDiv);
    }
}

function saveCurrentData(key, val) {
    if(!userStorage[currentShowingDate]) userStorage[currentShowingDate] = {};
    if(key) userStorage[currentShowingDate][key] = val;
    userStorage[currentShowingDate].write_c = document.getElementById('write_c_input').value;
    userStorage[currentShowingDate].write_a = document.getElementById('write_a_input').value;
    userStorage[currentShowingDate].done = true;
    localStorage.setItem('cal_progress_2026', JSON.stringify(userStorage));
    renderCalendarNav();
}

function generateWeeklyReport() {
    let report = "è¯·ä½œä¸ºæˆ‘çš„è¯­è¨€æ•™ç»ƒå’Œæ–‡å­¦å¯¼å¸ˆï¼Œå¯¹æœ¬å‘¨å†…å®¹è¿›è¡Œæ·±åº¦ Reviewï¼š\n\n";
    const dates = Object.keys(userStorage).sort();
    if (dates.length === 0) { alert("æš‚æ— æ•°æ®"); return; }
    dates.forEach(d => {
        const item = userStorage[d];
        report += `--- æ—¥æœŸ: ${d} ---\n`;
        if (item.jp_text) report += `[æ—¥è¯­]: ${item.jp_text}\n`;
        if (item.fr_text) report += `[æ³•è¯­]: ${item.fr_text}\n`;
        if (item.write_c) report += `[å¸¸è§„]: ${item.write_c}\n`;
        if (item.write_a) report += `[æ„Ÿå®˜]: ${item.write_a}\n\n`;
    });
    const copyArea = document.getElementById('copy-temp');
    copyArea.value = report;
    copyArea.select();
    document.execCommand('copy');
    alert("æœ¬å‘¨å†…å®¹å·²æˆåŠŸå¤åˆ¶ï¼");
}

function exportData() {
    const blob = new Blob([JSON.stringify(userStorage)], {type: "application/json"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `calendar_backup.json`;
    a.click();
}

function importData(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
        userStorage = JSON.parse(e.target.result);
        localStorage.setItem('cal_progress_2026', JSON.stringify(userStorage));
        location.reload();
    };
    reader.readAsText(file);
}

function toggleAdult() {
    const c = document.getElementById('adult-content');
    c.style.display = (c.style.display === 'block') ? 'none' : 'block';
}

function renderCalendarNav() {
    const nav = document.getElementById('calendar-view');
    nav.innerHTML = '';
    for(let i=1; i<=31; i++) {
        const dStr = `2026-01-${String(i).padStart(2,'0')}`;
        const dot = document.createElement('div');
        dot.className = `cal-dot ${dStr === currentShowingDate ? 'active' : ''}`;
        if (calendarData.find(x => x.date === dStr)) dot.classList.add('has-data');
        if (userStorage[dStr]?.done) dot.classList.add('completed');
        dot.innerText = i;
        dot.onclick = () => loadDate(dStr);
        nav.appendChild(dot);
    }
}
window.onload = init;
</script>
</body>
</html>